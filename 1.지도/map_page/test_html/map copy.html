<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>ì§€ë„ í˜ì´ì§€</title>

  <!-- tailwindcss import -->
  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="stylesheet" href="./style.css">

</head>
<body class="flex">

  <!-- ì¢Œì¸¡ ë„¤ë¹„(ë¡œì»¬ ì´ë¯¸ì§€ ì•„ì´ì½˜ ì‚¬ìš©) -->
  <aside class="w-36 bg-[#FFFFFF] border-r flex flex-col justify-between py-4 shadow z-[3000]">
  
    <!-- í™œì„± ìƒíƒœëŠ” aria-current="page" ë¡œ í‘œì‹œ-->
    <!-- ìƒë‹¨ ê·¸ë£¹ -->
    <div class="flex flex-col items-center space-y-6 w-full">

      <!-- í™ˆ í™”ë©´(ë©”ì¸ ì§€ë„) -->
      <button class="side-btn w-36 h-24 flex items-center justify-center rounded-lg hover:bg-[#F8C74D]" aria-current="page" data-tab="map" title="ì§€ë„">
        <img src="./assets/icons/Home.png" alt="ì§€ë„" class="side-icon w-12 h-12"/>
      </button>
      
      <!-- ì¶”ì²œ í”¼ë“œ & ê²€ìƒ‰ -->
      <button class="side-btn w-36 h-24 flex items-center justify-center rounded-lg hover:bg-[#F8C74D]" data-tab="search" title="ê²€ìƒ‰">
        <img src="./assets/icons/Search.png" alt="ê²€ìƒ‰" class="side-icon w-12 h-12"/>
      </button>
    
      <!-- íŒ”ë¡œìš° í”¼ë“œ -->
      <button class="side-btn w-36 h-24 flex items-center justify-center rounded-lg hover:bg-[#F8C74D]" data-tab="user" title="ì‚¬ìš©ì">
        <img src="./assets/icons/Compass.png" alt="ì‚¬ìš©ì" class="side-icon w-12 h-12"/>
      </button>
    
      <!-- ê°€ê²Œ ìˆœìœ„ -->
      <button class="side-btn w-36 h-24 flex items-center justify-center rounded-lg hover:bg-[#F8C74D]" data-tab="crown" title="ì™•ê´€">
        <img src="./assets/icons/Award.png" alt="ì¶”ì²œ" class="side-icon w-12 h-12"/>
      </button>
    </div>

    <!-- í•˜ë‹¨ ê·¸ë£¹ -->
    <div class="flex flex-col items-center space-y-6 w-full">
      
      <!-- ë§ˆì´í˜ì´ì§€ -->
      <button class="side-btn w-36 h-24 flex items-center justify-center hover:bg-[#F8C74D]" data-tab="setting" title="ì„¤ì •">
        <img src="./assets/icons/User.png" alt="ì„¤ì •" class="side-icon w-12 h-12"/>
      </button>
    
      <!-- ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ -->
      <button class="side-btn w-36 h-24 flex items-center justify-center hover:bg-[#F8C74D]" data-tab="logout" title="ë¡œê·¸ì•„ì›ƒ">
        <img src="./assets/icons/Logout.png" alt="ë¡œê·¸ì•„ì›ƒ" class="side-icon w-12 h-12"/>
      </button>
    </div>
  </aside>


  <!-- ì§€ë„ ì˜ì—­ -->
  <main class="flex-1 relative">
    <div id="status">í˜„ì¬ ìœ„ì¹˜ íŒŒì•… ì¤‘â€¦</div>
    <button id="loadMore">ë”ë³´ê¸° (20ê°œ)</button>    
    <div id="map"></div>

    
    <!-- ì„ì‹œ ê³ ì • í•€ ì•„ì´ì½˜ -->
    <img src="./assets/pin_icons/pin4.png" 
      alt="ê³ ì •í•€" 
      class="absolute top-1/2 left-1/2 w-8 h-8 -translate-x-1/2 -translate-y-1/2 z-[1000] cursor-pointer"/>
       
    <!-- ì§€ë„ ìš°ì¸¡ í•˜ë‹¨ ë²„íŠ¼ ê·¸ë£¹ -->
    <div class="absolute bottom-4 right-4 z-[1000] flex items-center space-x-2 bg-none p-2 rounded-lg text-lg">
    
      <!-- í•œì‹ -->
      <button class="food-btn" aria-pressed="false">
        <span class="icon-wrap">
          <img src="./assets/map_icons/koreanfood_icon.png" alt="í•œì‹"/>
        </span>
        <span>í•œì‹</span>
      </button>

      <!-- ì¤‘ì‹ -->
      <button class="food-btn" aria-pressed="false">
        <span class="icon-wrap">
          <img src="./assets/map_icons/chinesefood_icon.png" alt="ì¤‘ì‹"/>
        </span>
        <span>ì¤‘ì‹</span>
      </button>

      <!-- ì¼ì‹ -->
      <button class="food-btn" aria-pressed="false">
        <span class="icon-wrap">
          <img src="./assets/map_icons/japanesefood_icon.png" alt="ì¼ì‹"/>
        </span>
        <span>ì¼ì‹</span>
      </button>

      <!-- ì–‘ì‹ -->
      <button class="food-btn" aria-pressed="false">
        <span class="icon-wrap">
          <img src="./assets/map_icons/westernfood_icon.png" alt="ì–‘ì‹"/>
        </span>
        <span>ì–‘ì‹</span>
      </button>

      <!-- ë¶„ì‹ -->
      <button class="food-btn" aria-pressed="false">
        <span class="icon-wrap">
          <img src="./assets/map_icons/schoolfood_icon.png" alt="ë¶„ì‹"/>
        </span>
        <span>ë¶„ì‹</span>
      </button>


      <!-- í™•ëŒ€/ì¶•ì†Œ -->
      <div class="flex flex-col ml-2">
        
        <!-- ì¤Œì¸ ë²„íŠ¼ -->
        <button id="zoomIn" class="w-12 h-12 flex items-center justify-center bg-gray-100 rounded hover:bg-[#F8C74D] mb-1">+</button>
        
        <!-- ì¤Œ ì•„ì›ƒ ë²„íŠ¼ -->
        <button id="zoomOut" class="w-12 h-12 flex items-center justify-center bg-gray-100 rounded hover:bg-[#F8C74D] mb-1">-</button>
    
        <!-- í˜„ì¬ ìœ„ì¹˜ -->
        <button id="currentLocationBtn" class="w-12 h-12 flex items-center justify-center bg-gray-100 rounded hover:bg-[#F8C74D]">
          <img src="./assets/icons/current_location.png" alt="í˜„ì¬ ìœ„ì¹˜" class="w-5 h-5"/>
        </button>
      </div>
    </div>


  
    <!-- ì¢Œì¸¡ ìŠ¬ë¼ì´ë“œ íŒ¨ë„ -->
    <aside id="shopPanel" 
    class="fixed top-0 left-36 w-[33vw] h-full bg-white shadow-lg -translate-x-full transition-transform duration-300 z-[2000] overflow-y-auto">

      <!-- ê²€ìƒ‰ì¹¸ìœ¼ë¡œ ë³€ê²½í•´ì•¼ í•¨ -->
      <div class="p-4 flex justify-between items-center border-b bg-[#FBA62C]">
        <h2 class="text-lg font-bold">ê°•ë‚¨êµ¬ ì—­ì‚¼1ë™</h2>
        
        <!-- ì¶”í›„ì— ê²€ìƒ‰ ì¹¸ ì¶”ê°€ -->

        <!-- ìŠ¬ë¼ì´ë“œ ë‹«ê¸° ë²„íŠ¼ -->
        <button id="panelClose" class="text-xl w-8 h-8 rounded hover:bg-[#845717]">Ã—</button>
      </div>
  
      <!-- JSì—ì„œ ë™ì ìœ¼ë¡œ ë‚´ìš©ì„ ì±„ìš¸ ì˜ì—­ -->
      <div id="shopContent" class="p-4"></div>
    </aside>
  </main>

  <!-- ë¦¬ë·° ì´ë¯¸ì§€ í´ë¦­ ì‹œ ì›ë³¸ í¬ê¸°ë¡œ ì‚¬ì§„ ë³¼ ìˆ˜ ìˆëŠ” Lightbox Modal -->
  <!-- Lightbox Modal -->
  <div id="lightbox" class="fixed inset-0 z-[5000] hidden">
  
    <!-- ë°˜íˆ¬ëª… ë°±ë“œë¡­ -->
    <div id="lbBackdrop" class="absolute inset-0 bg-black/70"></div>

    <!-- ì½˜í…ì¸  ë˜í¼ -->
    <div class="relative w-full h-full grid place-items-center p-4">
    
      <!-- ë‹«ê¸° ë²„íŠ¼ -->
      <button id="lbClose" class="absolute top-4 right-4 w-10 h-10 text-2xl
      bg-white/90 hover:bg-white rounded-full grid place-items-center shadow">Ã—
      </button>

      <!-- ì›ë³¸ ì´ë¯¸ì§€ -->
      <img id="lbImage" alt="ì›ë³¸ ì´ë¯¸ì§€"
      class="w-[90vw] max-h-[85vh] h-auto object-contain rounded shadow-lg border bg-white"/>
    
      <!-- ìº¡ì…˜ -->
      <div id="lbCaption" class="mt-2 text-white/90 text-sm"></div>
    </div>
  </div>
  

  <!-- ì¹´ì¹´ì˜¤ ë§µ API ë° ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ -->
  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=0698fb5cbfd3626afb61d071e360de06&libraries=services,clusterer"></script>
  <script>
    // ì§€ë„ ìƒì„±
    //const map = L.map('map').setView([37.4979, 127.0276], 15);
    var container = document.getElementById('map'); //ì§€ë„ë¥¼ ë‹´ì„ ì˜ì—­ì˜ DOM ë ˆí¼ëŸ°ìŠ¤
    var options = { //ì§€ë„ë¥¼ ìƒì„±í•  ë•Œ í•„ìš”í•œ ê¸°ë³¸ ì˜µì…˜
      center: new kakao.maps.LatLng(37.5665, 126.9780), // ì„œìš¸ì‹œì²­ ê·¼ì²˜
      draggable : true,
      level: 3 //ì§€ë„ì˜ ë ˆë²¨(í™•ëŒ€, ì¶•ì†Œ ì •ë„)
    };
    //window.map = new kakao.maps.Map(container, options); // ì „ì—­ ë…¸ì¶œ(ë²„íŠ¼ í•¸ë“¤ëŸ¬ì—ì„œ ì ‘ê·¼)
    const geocoder = new kakao.maps.services.Geocoder();
    var map = new kakao.maps.Map(container, options); //ì§€ë„ ìƒì„± ë° ê°ì²´ ë¦¬í„´
  
// ========= í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤(ì§€ë„ ì¤‘ì‹¬ì„ ë”°ë¼ ì´ë™) =========
    const myIcon = new kakao.maps.MarkerImage(
      './assets/pin_icons/pin5.png',
      new kakao.maps.Size(32, 32),
      { offset: new kakao.maps.Point(16, 32) }
    );
    // (ì•„ì´ì½˜ ì œê±°: ê¸°ë³¸ ë§ˆì»¤ ì‚¬ìš©)
    let currentMarker = new kakao.maps.Marker({
      map,
      position: map.getCenter(),
      zIndex: 999
    });


// ì§€ë„ ì´ë™/ì¤Œ ì¢…ë£Œë§ˆë‹¤ í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ë¥¼ ì§€ë„ ì¤‘ì‹¬ìœ¼ë¡œ ì´ë™
    let districtDebounce = null;
    let lastDistrict = null;

    kakao.maps.event.addListener(map, 'idle', () => {
      const c = map.getCenter();
      currentMarker.setPosition(c);

      // (ì„ íƒ) êµ¬ ìë™ ê°±ì‹ : ë””ë°”ìš´ìŠ¤
      clearTimeout(districtDebounce);
      districtDebounce = setTimeout(resolveDistrictAndReloadByCenter, 400);
    });

// ========= ì£¼ì†Œ ì •ì œ/ì¶”ì¶œ =========
    function cleanNewAddress(addr) {
      if (!addr) return '';
      // "ì„œìš¸" ì•ì˜ ìš°í¸ë²ˆí˜¸/ê³µë°± ì œê±°
      return addr.replace(/^\d*\s*ì„œìš¸/, 'ì„œìš¸').trim();
    }
    function cleanOldAddress(addr) {
      if (!addr) return '';
      // "525-13 525-13" ê°™ì€ ë²ˆì§€ ì¤‘ë³µ ì œê±°
      return addr.replace(/(\d+-?\d*)\s+\1/, '$1').trim();
    }
    function extractDistrict(addr) {
      if (!addr) return '';
      const m = addr.match(/ì„œìš¸\s+\S+êµ¬/);
      return m ? m[0] : '';
    }

    // ========= ì»¤ìŠ¤í…€ ë§ˆì»¤ ìƒì„± =========
    const shopIcon = new kakao.maps.MarkerImage(
      './assets/pin_icons/pin5.png',
      new kakao.maps.Size(32, 32),
      { offset: new kakao.maps.Point(16, 32) }
    );
    function placeMarker(pos, title, shownAddr) {
      const marker = new kakao.maps.Marker({
        map, position: pos, title, image: shopIcon
      });
      markers.push(marker);

      const iwContent = `<div style="padding:5px;font-size:13px;">${title}<br>${shownAddr}</div>`;
      const infowindow = new kakao.maps.InfoWindow({ content: iwContent, removable: true });
      kakao.maps.event.addListener(marker, 'click', () => infowindow.open(map, marker));
    }

    // ========= ì§€ì˜¤ì½”ë”© + 3ë‹¨ê³„ fallback =========
    function searchAndMark(addr, title, type, fallback = null) {
      if (!addr) {
        console.warn(`[${title}] ${type}: ì£¼ì†Œ ì—†ìŒ`);
        if (fallback) fallback();
        return;
      }
      // console.log(`[${title}] ${type} ì‹œë„ â†’`, addr);
      geocoder.addressSearch(addr, (result, status) => {
        if (status === kakao.maps.services.Status.OK && result[0]) {
          // console.log(`[${title}] ${type} ì„±ê³µ âœ…`, result[0]);
          const pos = new kakao.maps.LatLng(result[0].y, result[0].x);
          placeMarker(pos, title, addr);
        } else {
          // console.warn(`[${title}] ${type} ì‹¤íŒ¨ âŒ`, status, addr);
          if (fallback) fallback();
          else console.error(`[${title}] ìµœì¢… ì‹¤íŒ¨ âŒ`, addr, status);
        }
      });
    }

    function addMarkerWithFallback(shop, title='') {
      const newAddr = cleanNewAddress(shop.new_address || '');
      const oldAddr = cleanOldAddress(shop.address || '');
      const district = extractDistrict(shop.address || '');
      const combined = district && title ? `${district} ${title}` : '';

      // 1) new_address â†’ 2) address â†’ 3) "ì„œìš¸ â—‹â—‹êµ¬ + ìƒí˜¸ëª…"
      searchAndMark(newAddr, title, 'new_address', () =>
        searchAndMark(oldAddr, title, 'address', () =>
          searchAndMark(combined, title, 'district+post_sj')
        )
      );
    }

    // ========= í˜ì´ì§€ë„¤ì´ì…˜ & ë§ˆì»¤ ê´€ë¦¬ =========
    let shops = [];
    let page = 0;
    const pageSize = 20;
    const markers = [];

    function clearMarkers() {
      markers.forEach(m => m.setMap(null));
      markers.length = 0;
    }

    function resetPaging() {
      page = 0;
      clearMarkers();
      document.getElementById('loadMore').style.display = 'none';
    }

    function showPage(p) {
      const start = p * pageSize;
      const end = start + pageSize;
      shops.slice(start, end).forEach((shop, i) => {
        const name = shop.post_sj || `ê°€ê²Œ ${start + i + 1}`;
        addMarkerWithFallback(shop, name);
      });
    }

    function showNextPage() {
      if (page * pageSize >= shops.length) {
        alert('ë” ì´ìƒ ë¶ˆëŸ¬ì˜¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      showPage(page++);
    }

    document.getElementById('loadMore').addEventListener('click', showNextPage);

    // ========= êµ¬ ë‹¨ìœ„ ë°ì´í„° ë¡œë”© =========
    const $status = document.getElementById('status');

    function loadDistrictJsonAndRender(districtName) {
      const filePath = `./assets/location_seperate/seoul_${districtName}.json`;
      // console.log('íŒŒì¼ ë¡œë“œ:', filePath);

      resetPaging();
      fetch(filePath)
        .then(res => {
          if (!res.ok) throw new Error(`JSON ë¡œë“œ ì‹¤íŒ¨: ${res.status}`);
          return res.json();
        })
        .then(data => {
          shops = data.DATA || [];
          $status.textContent = `í˜„ì¬ ì§€ì—­: ì„œìš¸ ${districtName} (ì´ ${shops.length}ê±´)`;
          showNextPage(); // ì²« 20ê°œ í‘œì‹œ
          if (shops.length > pageSize) {
            document.getElementById('loadMore').style.display = 'inline-block';
          }
        })
        .catch(err => {
          console.error(err);
          $status.textContent = `í•´ë‹¹ êµ¬ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨(ì„œìš¸ ${districtName}). íŒŒì¼/ê²½ë¡œ í™•ì¸ í•„ìš”`;
        });
    }

    // ========= ì—­ì§€ì˜¤ì½”ë”©ìœ¼ë¡œ í˜„ì¬ êµ¬ íŒë³„ =========
    function resolveDistrictByLatLng(lat, lng, cb) {
      geocoder.coord2RegionCode(lng, lat, (result, status) => {
        if (status !== kakao.maps.services.Status.OK || !result?.length) return cb(null);
        const info = result.find(r => r.region_type === 'B') || result[0];
        const city = info.region_1depth_name;      // "ì„œìš¸íŠ¹ë³„ì‹œ"
        const district = info.region_2depth_name;  // "ê°•ë‚¨êµ¬" ë“±
        if (!city?.startsWith('ì„œìš¸')) return cb(null);
        cb(district);
      });
    }

    // ì§€ë„ ì¤‘ì‹¬ ê¸°ì¤€ìœ¼ë¡œ êµ¬ íŒë³„ í›„ í•„ìš” ì‹œ ì¬ë¡œë”©(ë””ë°”ìš´ìŠ¤ë¡œ í˜¸ì¶œ)
    function resolveDistrictAndReloadByCenter() {
      const c = map.getCenter();
      resolveDistrictByLatLng(c.getLat(), c.getLng(), (district) => {
        if (!district) return;
        if (district !== lastDistrict) {
          lastDistrict = district;
          $status.textContent = `í˜„ì¬ ìœ„ì¹˜: ì„œìš¸ ${district} (í•´ë‹¹ êµ¬ ë°ì´í„° ë¡œë“œ ì¤‘â€¦)`;
          loadDistrictJsonAndRender(district);
        }
      });
    }

    // ========= ì´ˆê¸° í˜„ì¬ ìœ„ì¹˜ ì²˜ë¦¬ =========
    if ('geolocation' in navigator) {
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const lat = pos.coords.latitude;
          const lng = pos.coords.longitude;
          const center = new kakao.maps.LatLng(lat, lng);
          map.setCenter(center);
          map.setLevel(6);
          currentMarker.setPosition(center); // â‘¢ ì´ˆê¸° ì„¤ì • ì‹œ í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ ë™ê¸°í™”
          $status.textContent = 'í˜„ì¬ ìœ„ì¹˜ í™•ì¸ ì™„ë£Œ. êµ¬ ì‹ë³„ ì¤‘â€¦';

          resolveDistrictByLatLng(lat, lng, (district) => {
            if (!district) {
              $status.textContent = 'ì„œìš¸ ì™¸ ì§€ì—­ì…ë‹ˆë‹¤. ì§€ë„ë¥¼ ì´ë™í•´ ì£¼ì„¸ìš”.';
              return;
            }
            lastDistrict = district;
            loadDistrictJsonAndRender(district);
          });
        },
        (err) => {
          console.warn('Geolocation ì‹¤íŒ¨:', err);
          $status.textContent = 'ìœ„ì¹˜ ê¶Œí•œ ê±°ë¶€ë¨. ì§€ë„ ì¤‘ì‹¬ ê¸°ì¤€ìœ¼ë¡œ êµ¬ë¥¼ ì‹ë³„í•©ë‹ˆë‹¤.';
          // ì§€ë„ ì¤‘ì‹¬ìœ¼ë¡œ êµ¬ íŒë³„
          resolveDistrictAndReloadByCenter();
        },
        { enableHighAccuracy: true, timeout: 8000, maximumAge: 0 }
      );
    } else {
      $status.textContent = 'ë¸Œë¼ìš°ì €ê°€ ìœ„ì¹˜ ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
      resolveDistrictAndReloadByCenter();
    }
    // ì¤Œì¸/ì¤Œì•„ì›ƒ (KakaoëŠ” setLevel ì‚¬ìš©)
    document.getElementById("zoomIn").addEventListener("click", function () {
      var level = map.getLevel();
      if (level > 1) map.setLevel(level - 1);
    });

    document.getElementById("zoomOut").addEventListener("click", function () {
      var level = map.getLevel();
      map.setLevel(level + 1);
    });

    // í˜„ì¬ ìœ„ì¹˜ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    //var currentMarker = null;

    // í˜„ì¬ ìœ„ì¹˜ë¡œ ì§€ë„ ì´ë™ + ë§ˆì»¤ í‘œì‹œ (ê³µìš© í•¨ìˆ˜)
    function goToCurrentLocation() {
      if (!navigator.geolocation) {
        console.warn("ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ìœ„ì¹˜ ì •ë³´ê°€ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        return;
      }
      navigator.geolocation.getCurrentPosition(
        function (pos) {
          var lat = pos.coords.latitude;
          var lng = pos.coords.longitude;
          var loc = new kakao.maps.LatLng(lat, lng);

          currentMarker.setPosition(loc);
          map.setCenter(loc);
          map.setLevel(3);

          if (currentMarker) currentMarker.setMap(null);
          currentMarker = new kakao.maps.Marker({ position: loc });
          currentMarker.setMap(map);
        },
        function (err) {
          console.warn("í˜„ì¬ ìœ„ì¹˜ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (" + err.message + ")");
          // í•„ìš” ì‹œ: ê¸°ë³¸ ì¤‘ì‹¬ ìœ ì§€(ì§€ê¸ˆì²˜ëŸ¼) ë˜ëŠ” ê°•ë‚¨ ë“± ì›í•˜ëŠ” ì¢Œí‘œë¡œ fallback ê°€ëŠ¥
          // map.setCenter(new kakao.maps.LatLng(37.4979, 127.0276));
        },
        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
      );
    }
    document.getElementById("currentLocationBtn").addEventListener("click", goToCurrentLocation);

    // DOMì´ ì¤€ë¹„ë˜ë©´ ë°”ë¡œ í˜„ì¬ ìœ„ì¹˜ë¡œ ì´ë™
    window.addEventListener('DOMContentLoaded', goToCurrentLocation);
    // ë˜ëŠ” window.addEventListener('load', goToCurrentLocation);

    // ìŒì‹ ë²„íŠ¼: ë‹¤ì¤‘ ì„ íƒ + ë‹¤ì‹œ í´ë¦­ ì‹œ í•´ì œ
    const foodBtns = document.querySelectorAll('.food-btn');

    foodBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const isActive = btn.getAttribute('aria-pressed') === 'true';
        btn.setAttribute('aria-pressed', String(!isActive));
        // ì„ íƒ ìƒíƒœ ë³€í™”ì— ë§ì¶° í•„ìš”í•œ í•„í„° ë¡œì§ì´ ìˆìœ¼ë©´ ì—¬ê¸°ì„œ í˜¸ì¶œ
        // e.g., applyFoodFilter(getSelectedFoods());
      });
    });

    // í˜„ì¬ ì„ íƒëœ í•­ëª© ëª©ë¡ ì–»ê¸°
    function getSelectedFoods() {
      return [...document.querySelectorAll('.food-btn[aria-pressed="true"]')]
        .map(b => b.dataset.key || b.textContent.trim());
    }
    // ì¢Œì¸¡ ì‚¬ì´ë“œ íƒ­ í™œì„±í™” í† ê¸€ ìœ í‹¸ (í•„ìš”í•œ í˜ì´ì§€ì—ì„œ í˜¸ì¶œ)
    function setActiveTab(tabName) {
      document.querySelectorAll('.side-btn').forEach(btn => {
        if (btn.dataset.tab === tabName) {
          btn.setAttribute('aria-current', 'page');
        } else {
          btn.removeAttribute('aria-current');
        }
      });
    }

    // ì´ í˜ì´ì§€ëŠ” map í˜ì´ì§€ì´ë¯€ë¡œ ë³´ì¥
    setActiveTab('map');

    // ì•ˆì „ ë°”ì¸ë”©: idê°€ ì—†ê±°ë‚˜ pointerEventsê°€ ë§‰í˜€ ìˆì–´ë„ ì¼€ì–´
    const pin = document.getElementById('coloredPin') || document.querySelector('img[src$="./assets/pin_icons/pin4.png"]');
    const panel = document.getElementById('shopPanel');
    const btnClose = document.getElementById('panelClose');
    const shopContent = document.getElementById('shopContent');

    if (pin) {
      // í˜¹ì‹œ ëª¨ë¥¼ ì”ì—¬ ìŠ¤íƒ€ì¼ ë°©ì§€
      pin.style.pointerEvents = 'auto';

      pin.addEventListener('click', () => {
        // í•„ìš”ì‹œ ì—¬ê¸°ì„œ ì‹¤ì œ ê°€ê²Œ ë°ì´í„° ë°”ì¸ë”©
        //shopContent.textContent = 'í”„ì—”ì¹´í˜ - ì„œìš¸ ê°•ë‚¨êµ¬ / ì˜ì—…ì‹œê°„ 10:00 ~ 21:00';
        shopContent.innerHTML = `
        <!-- ëŒ€í‘œ ì´ë¯¸ì§€ -->
        <div class="w-full h-96 rounded-lg bg-gray-200 bg-center bg-center bg-contain bg-no-repeat" 
        style="background-image: url('./assets/info_assets/main_pic.png');">
        </div>

        <!-- ê°€ê²Œëª… / ì¹´í…Œê³ ë¦¬ + ë³„ì  -->
        <div class="flex justify-between items-center mt-4">
          <div>
            <h3 class="text-xl font-semibold">ì˜¤ì˜¤ê¸°ë¦¬</h3>
            <p class="text-gray-500 text-sm">ì¼ì‹</p>
          </div>
          <div class="flex items-center space-x-1 text-yellow-500">ğŸ“ŒğŸ“ŒğŸ“ŒğŸ“ŒğŸ“Œ</div>
        </div>

        <!-- ì—°ë½ì²˜ / ì˜ì—…ì‹œê°„ -->
        <p class="flex items-center gap-2">
        <img src="./assets/info_assets/tel_icon.png" alt="ì „í™”" class="w-5 h-5"/>
        02-1234-5678
        </p>

        <!-- ì¢‹ì•„ìš” / ë¦¬ë·° ì•ˆë‚´ -->
        <div class="text-sm text-gray-600 space-y-1 border-t pt-2 mt-2">
          <p>â™¥ ë‚´ íŒ”ë¡œì›Œ 2ëª…ì´ ì¢‹ì•„ìš”ë¥¼ ëˆŒë €ìŠµë‹ˆë‹¤.</p>
          <p>â— xxxë‹˜ì´ ë¦¬ë·°ë¥¼ ì‘ì„±í•œ ì‹ë‹¹ì…ë‹ˆë‹¤.</p>
        </div>

        <!-- ë¦¬ë·° ì„¹ì…˜ -->
        <div class="border-t pt-4 mt-2">
          <div class="flex items-center justify-between mb-2">
            <h4 class="font-semibold">ë¦¬ë·° 112</h4>
            <button class="text-blue-500 text-sm">ë”ë³´ê¸°</button>
          </div>
          
          <div class="grid grid-cols-3 gap-2">
            <div class="h-40 rounded overflow-hidden"><img src="./assets/info_assets/review01.png" alt="ë¦¬ë·°1" class="w-full h-full object-cover"></div>
            <div class="h-40 rounded overflow-hidden"><img src="./assets/info_assets/review02.png" alt="ë¦¬ë·°2" class="w-full h-full object-cover"></div>
            <div class="h-40 rounded overflow-hidden"><img src="./assets/info_assets/review03.png" alt="ë¦¬ë·°3" class="w-full h-full object-cover"></div>
            <div class="h-40 rounded overflow-hidden"><img src="./assets/info_assets/review04.png" alt="ë¦¬ë·°4" class="w-full h-full object-cover"></div>
            <div class="h-40 rounded overflow-hidden"><img src="./assets/info_assets/review05.png" alt="ë¦¬ë·°5" class="w-full h-full object-cover"></div>
          </div>
        </div>
        `;
        
        panel.classList.remove('-translate-x-full');
        panel.classList.add('translate-x-0');
        // ë””ë²„ê·¸ìš©(í•„ìš”ì‹œ ì¼œê¸°): console.log('[PIN] clicked');
    });
  }

  // ë²„íŠ¼ìœ¼ë¡œ ì¢Œì¸¡ ìŠ¬ë¼ì´ë“œ ë‹«ê¸°  
  btnClose?.addEventListener('click', () => {
    panel.classList.remove('translate-x-0');
    panel.classList.add('-translate-x-full');
  });

  // ESCë¡œ ì¢Œì¸¡ ìŠ¬ë¼ì´ë“œ ë‹«ê¸°
  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      panel.classList.remove('translate-x-0');
      panel.classList.add('-translate-x-full');
    }
  });

  // ì§€ë„ í´ë¦­ ì‹œ ì¢Œì¸¡ ìŠ¬ë¼ì´ë“œ ë‹«ê¸°
  const mapEl = document.getElementById('map');
  mapEl.addEventListener('click', () => {
    panel.classList.remove('translate-x-0');
    panel.classList.add('-translate-x-full');
  });

  // ===== Lightbox =====
  const lightbox   = document.getElementById('lightbox');
  const lbImg      = document.getElementById('lbImage');
  const lbCaption  = document.getElementById('lbCaption');
  const lbClose    = document.getElementById('lbClose');
  const lbBackdrop = document.getElementById('lbBackdrop');

  function openLightbox(src, caption='') {
    lbImg.src = src;
    lbCaption.textContent = caption;
    lightbox.classList.remove('hidden');
    document.body.style.overflow = 'hidden'; // ìŠ¤í¬ë¡¤ ì ê¸ˆ
  }

  function closeLightbox() {
    lightbox.classList.add('hidden');
    lbImg.src = '';
    lbCaption.textContent = '';
    document.body.style.overflow = ''; // ìŠ¤í¬ë¡¤ ë³µêµ¬
  }

  // ë‹«ê¸° ë™ì‘
  lbClose.addEventListener('click', closeLightbox);
  lbBackdrop.addEventListener('click', closeLightbox);
  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeLightbox();
  });

  // === ì´ë²¤íŠ¸ ìœ„ì„: shopPanel ë‚´ ì¸ë„¤ì¼ í´ë¦­ ì‹œ ì›ë³¸ ì—´ê¸° ===
  const panelEl = document.getElementById('shopPanel');
  panelEl.addEventListener('click', (e) => {
    const img = e.target.closest('#shopContent img');
    if (!img) return;

    // data-full ì´ ìˆìœ¼ë©´ ì›ë³¸ ê²½ë¡œë¡œ, ì—†ìœ¼ë©´ ì¸ë„¤ì¼ ê²½ë¡œ ì‚¬ìš©
    const fullSrc = img.getAttribute('data-full') || img.src;

    // ìº¡ì…˜ì€ alt ì‚¬ìš©
    openLightbox(fullSrc, img.alt || '');
  });

  </script>

</body>
</html>
